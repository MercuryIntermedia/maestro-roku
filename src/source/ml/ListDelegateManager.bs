namespace ml

  class ListDelegateManager
    private cellDelegateFunctionMap = {
      "didEnter": "onCellDidEnter"
      "didExit": "onCellDidExit"
      "willGainFocus": "onCellWillGainFocus"
      "willLoseFocus": "onCellWillLoseFocus"
      "didGainFocus": "onCellDidGainFocus"
      "didLoseFocus": "onCellDidLoseFocus"
      "gainingFocus": "onCellGainingFocus"
      "losingFocus": "onCellLosingFocus"
    }
    private componentFunctionMap = {
      "didEnter": "onDidEnter"
      "didExit": "onDidExit"
      "willGainFocus": "onWillGainFocus"
      "willLoseFocus": "onWillLoseFocus"
      "didGainFocus": "onDidGainFocus"
      "didLoseFocus": "onDidLoseFocus"
      "gainingFocus": "onGainingFocus"
      "losingFocus": "onLosingFocus"
    }

    private rowDelegateFunctionMap = {
      "didEnter": "onRowDidEnter"
      "didExit": "onRowDidExit"
      "willGainFocus": "onRowWillGainFocus"
      "willLoseFocus": "onRowWillLoseFocus"
      "didGainFocus": "onRowDidGainFocus"
      "didLoseFocus": "onRowDidLoseFocus"
      "gainingFocus": "onRowGainingFocus"
      "losingFocus": "onRowLosingFocus"
    }
    private list as mc.types.node

    function new(list as mc.types.node)
      m.list = list
    end function

    function callCellDelegateMethod(cell as mc.types.node, eventName as string, event as mc.types.assocarray) as void
      delegateFunctionName = m.cellDelegateFunctionMap[eventName]
      cellFunctionName = m.componentFunctionMap[eventName]
      if delegateFunctionName = invalid
        ? "CELL EVENT(skipped) " ; eventName ; " " ; event.direction ; " I " ; "" ; event.index ; " " ; event.fraction
        return
      end if
      ' ? "onListEventBridge OBSERVED " ; eventName

      if delegateFunctionName = "onCellGainingFocus" or delegateFunctionName = "onCellLosingFocus"
        cell@._apply(cellFunctionName, [event.direction, event.fraction])
        m.list@._apply(delegateFunctionName, [event.rowIndex, event.index, event.direction, event.fraction])

      else
        cell@._apply(delegateFunctionName, [cellFunctionName, event.direction])
        m.list@._apply(delegateFunctionName, [event.rowIndex, event.index, event.direction, event.fraction])
      end if
    end function

    function callRowDelegateMethod(row as mc.types.node, eventName as string, event as mc.types.assocarray) as void
      rowDelegateFunctionName = m.componentFunctionMap[eventName]
      rowFunctionName = m.componentFunctionMap[eventName]
      if rowDelegateFunctionName = invalid
        ? "ROW EVENT(skipped) " ; eventName ; " " ; event.direction ; " I " ; "" ; event.index ; " " ; event.fraction
        return
      end if

      ' ? "LE  " ; eventName ; " " ; event.direction ; " I " ; "" ; event.index ; " " ; event.fraction
      if rowDelegateFunctionName = "onRowScrollingChange"
        row@._apply(rowFunctionName, [event.isScrolling, event.subRowIndex, event.isLong])
        m.list@._apply(rowDelegateFunctionName, [event.isScrolling, event.rowIndex, event.subRowIndex, event.isLong])

      else if rowDelegateFunctionName = "onScrollingUpdate"
        row@._apply(rowFunctionName, [event.startIndex, event.subRowIndex, event.currentIndex])
        m.list@._apply(rowDelegateFunctionName, [event.startIndex, event.subRowIndex, event.currentIndex])

      else if rowDelegateFunctionName = "onRowGainingFocus" or rowDelegateFunctionName = "onRowLosingFocus"
        'TODO HERE WE NEED TO SEND SUBROW INDEX EVENTS!![[]]
        row@._apply(rowFunctionName, [event.index, event.subRowIndex, event.direction, event.fraction])
        m.list@._apply(rowDelegateFunctionName, [event.index, event.subRowIndex, event.direction, event.fraction])

      else if rowDelegateFunctionName = "onItemSelected"
        row@._apply(rowFunctionName, [event.index, event.subRowIndex, event.cellIndex])
        m.list@._apply(rowDelegateFunctionName, [event.index, event.subRowIndex, event.cellIndex])

      else
        row@._apply(rowFunctionName, [event.index, event.subRowIndex, event.direction])
        m.list@._apply(rowDelegateFunctionName, [event.index, event.subRowIndex, event.direction])
      end if

    end function
  end class

end namespace
